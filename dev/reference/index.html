<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reference · SnoopCompile</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SnoopCompile</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">SnoopCompile.jl</a></li><li><a class="tocitem" href="../snoopi/">Snooping on inference: <code>@snoopi</code></a></li><li><a class="tocitem" href="../snoopc/">Snooping on code generation: <code>@snoopc</code></a></li><li><a class="tocitem" href="../userimg/">Creating <code>userimg.jl</code> files</a></li><li><a class="tocitem" href="../snoopr/">Snooping on and fixing invalidations: <code>@snoopr</code></a></li><li class="is-active"><a class="tocitem" href>Reference</a><ul class="internal"><li><a class="tocitem" href="#Interactive-features-1"><span>Interactive features</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/timholy/SnoopCompile.jl/blob/master/docs/src/reference.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Reference-1"><a class="docs-heading-anchor" href="#Reference-1">Reference</a><a class="docs-heading-anchor-permalink" href="#Reference-1" title="Permalink"></a></h1><h2 id="Interactive-features-1"><a class="docs-heading-anchor" href="#Interactive-features-1">Interactive features</a><a class="docs-heading-anchor-permalink" href="#Interactive-features-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SnoopCompileCore.@snoopi" href="#SnoopCompileCore.@snoopi"><code>SnoopCompileCore.@snoopi</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia">inf_timing = @snoopi commands
inf_timing = @snoopi tmin=0.0 commands</code></pre><p>Execute <code>commands</code> while snooping on inference. Returns an array of <code>(t, linfo)</code> tuples, where <code>t</code> is the amount of time spent inferring <code>linfo</code> (a <code>MethodInstance</code>).</p><p>Methods that take less time than <code>tmin</code> will not be reported.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/SnoopCompileCore/src/snoopi.jl#L49-L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompileCore.@snoopc" href="#SnoopCompileCore.@snoopc"><code>SnoopCompileCore.@snoopc</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia">@snoopc &quot;compiledata.csv&quot; begin
    # Commands to execute, in a new process
end</code></pre><p>causes the julia compiler to log all functions compiled in the course of executing the commands to the file &quot;compiledata.csv&quot;. This file can be used for the input to <code>SnoopCompile.read</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/SnoopCompileCore/src/snoopc.jl#L5-L14">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompileCore.@snoopr" href="#SnoopCompileCore.@snoopr"><code>SnoopCompileCore.@snoopr</code></a> — <span class="docstring-category">Macro</span></header><section><div><pre><code class="language-julia">list = @snoopr expr</code></pre><p>Capture method cache invalidations triggered by evaluating <code>expr</code>. <code>list</code> is a sequence of invalidated <code>Core.MethodInstance</code>s together with &quot;explanations,&quot; consisting of integers (encoding depth) and strings (documenting the source of an invalidation).</p><p>Unless you are working at a low level, you essentially always want to pass <code>list</code> directly to <a href="@ref"><code>SnoopCompile.invalidation_trees</code></a>.</p><p><strong>Extended help</strong></p><p><code>list</code> is in a format where the &quot;reason&quot; comes after the items. Method deletion results in the sequence</p><pre><code class="language-none">[zero or more (mi, &quot;invalidate_mt_cache&quot;) pairs..., zero or more (depth1 tree, loctag) pairs..., method, loctag] with loctag = &quot;jl_method_table_disable&quot;</code></pre><p>where <code>mi</code> means a <code>MethodInstance</code>. <code>depth1</code> means a sequence starting at <code>depth=1</code>.</p><p>Method insertion results in the sequence</p><pre><code class="language-none">[zero or more (depth0 tree, sig) pairs..., same info as with delete_method except loctag = &quot;jl_method_table_insert&quot;]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/SnoopCompileCore/src/snoopr.jl#L3-L25">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.parcel" href="#SnoopCompile.parcel"><code>SnoopCompile.parcel</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>pc = parcel(calls; subst=[], exclusions=[])</code> assigns each compile statement to the module that owns the function. Perform string substitution via <code>subst=[&quot;Module1&quot;=&gt;&quot;Module2&quot;]</code>, and omit functions in particular modules with <code>exclusions=[&quot;Module3&quot;]</code>. On output, <code>pc[:Module2]</code> contains all the precompiles assigned to <code>Module2</code>.</p><p>Use <code>SnoopCompile.write(prefix, pc)</code> to generate a series of files in directory <code>prefix</code>, one file per module.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/parcel_snoopc.jl#L126-L130">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.write" href="#SnoopCompile.write"><code>SnoopCompile.write</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">write(prefix::AbstractString, pc::Dict; always::Bool = false)</code></pre><p>Write each modules&#39; precompiles to a separate file.  If <code>always</code> is true, the generated function will always run the precompile statements when called, otherwise the statements will only be called during package precompilation.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/write.jl#L19-L26">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.read" href="#SnoopCompile.read"><code>SnoopCompile.read</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>SnoopCompile.read(&quot;compiledata.csv&quot;)</code> reads the log file produced by the compiler and returns the functions as a pair of arrays. The first array is the amount of time required to compile each function, the second is the corresponding function + types. The functions are sorted in order of increasing compilation time. (The time does not include the cost of nested compiles.)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/parcel_snoopc.jl#L8-L10">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.format_userimg" href="#SnoopCompile.format_userimg"><code>SnoopCompile.format_userimg</code></a> — <span class="docstring-category">Function</span></header><section><div><p><code>pc = format_userimg(calls; subst=[], exclusions=[])</code> generates precompile directives intended for your base/userimg.jl script. Use <code>SnoopCompile.write(filename, pc)</code> to create a file that you can <code>include</code> into <code>userimg.jl</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/parcel_snoopc.jl#L178-L180">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.uinvalidated" href="#SnoopCompile.uinvalidated"><code>SnoopCompile.uinvalidated</code></a> — <span class="docstring-category">Function</span></header><section><div><p>umis = uinvalidated(invlist)</p><p>Return the unique invalidated MethodInstances. <code>invlist</code> is obtained from <a href="#SnoopCompileCore.@snoopr"><code>SnoopCompileCore.@snoopr</code></a>. This is similar to <code>filter</code>ing for <code>MethodInstance</code>s in <code>invlist</code>, except that it discards any tagged <code>&quot;invalidate_mt_cache&quot;</code>. These can typically be ignored because they are nearly inconsequential: they do not invalidate any compiled code, they only transiently affect an optimization of runtime dispatch.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/invalidations.jl#L12-L19">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.invalidation_trees" href="#SnoopCompile.invalidation_trees"><code>SnoopCompile.invalidation_trees</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">trees = invalidation_trees(list)</code></pre><p>Parse <code>list</code>, as captured by <a href="#SnoopCompileCore.@snoopr"><code>SnoopCompileCore.@snoopr</code></a>, into a set of invalidation trees, where parents nodes were called by their children.</p><p><strong>Example</strong></p><pre><code class="language-julia">julia&gt; f(x::Int)  = 1
f (generic function with 1 method)

julia&gt; f(x::Bool) = 2
f (generic function with 2 methods)

julia&gt; applyf(container) = f(container[1])
applyf (generic function with 1 method)

julia&gt; callapplyf(container) = applyf(container)
callapplyf (generic function with 1 method)

julia&gt; c = Any[1]
1-element Array{Any,1}:
 1

julia&gt; callapplyf(c)
1

julia&gt; trees = invalidation_trees(@snoopr f(::AbstractFloat) = 3)
1-element Array{SnoopCompile.MethodInvalidations,1}:
 inserting f(::AbstractFloat) in Main at REPL[36]:1 invalidated:
   mt_backedges: 1: signature Tuple{typeof(f),Any} triggered MethodInstance for applyf(::Array{Any,1}) (1 children) more specific</code></pre><p>See the documentation for further details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/invalidations.jl#L207-L242">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.filtermod" href="#SnoopCompile.filtermod"><code>SnoopCompile.filtermod</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">thinned = filtermod(module, trees::AbstractVector{MethodInvalidations})</code></pre><p>Select just the cases of invalidating a method defined in <code>module</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/invalidations.jl#L340-L344">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SnoopCompile.findcaller" href="#SnoopCompile.findcaller"><code>SnoopCompile.findcaller</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">methinvs = findcaller(method::Method, trees)</code></pre><p>Find a path through <code>trees</code> that reaches <code>method</code>. Returns a single <code>MethodInvalidations</code> object.</p><p><strong>Examples</strong></p><p>Suppose you know that loading package <code>SomePkg</code> triggers invalidation of <code>f(data)</code>. You can find the specific source of invalidation as follows:</p><pre><code class="language-none">f(data)                             # run once to force compilation
m = @which f(data)
using SnoopCompile
trees = invalidation_trees(@snoopr using SomePkg)
methinvs = findcaller(m, trees)</code></pre><p>If you don&#39;t know which method to look for, but know some operation that has had added latency, you can look for methods using <code>@snoopi</code>. For example, suppose that loading <code>SomePkg</code> makes the next <code>using</code> statement slow. You can find the source of trouble with</p><pre><code class="language-none">julia&gt; using SnoopCompile

julia&gt; trees = invalidation_trees(@snoopr using SomePkg);

julia&gt; tinf = @snoopi using SomePkg            # this second `using` will need to recompile code invalidated above
1-element Array{Tuple{Float64,Core.MethodInstance},1}:
 (0.08518409729003906, MethodInstance for require(::Module, ::Symbol))

julia&gt; m = tinf[1][2].def
require(into::Module, mod::Symbol) in Base at loading.jl:887

julia&gt; findcaller(m, trees)
inserting ==(x, y::SomeType) in SomeOtherPkg at /path/to/code:100 invalidated:
   backedges: 1: superseding ==(x, y) in Base at operators.jl:83 with MethodInstance for ==(::Symbol, ::Any) (16 children) more specific</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/timholy/SnoopCompile.jl/blob/33f40f8c4b8efa4955b0fadfeda7ccdfd53078cb/src/invalidations.jl#L363-L401">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../snoopr/">« Snooping on and fixing invalidations: <code>@snoopr</code></a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 13 December 2020 12:30">Sunday 13 December 2020</span>. Using Julia version 1.7.0-DEV.45.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
