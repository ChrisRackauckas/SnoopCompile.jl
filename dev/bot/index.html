<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SnoopCompile Bot (EXPERIMENTAL) · SnoopCompile</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">SnoopCompile</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">SnoopCompile.jl</a></li><li><a class="tocitem" href="../snoopi/">Snooping on inference: <code>@snoopi</code></a></li><li><a class="tocitem" href="../snoopc/">Snooping on code generation: <code>@snoopc</code></a></li><li><a class="tocitem" href="../userimg/">Creating <code>userimg.jl</code> files</a></li><li class="is-active"><a class="tocitem" href>SnoopCompile Bot (EXPERIMENTAL)</a><ul class="internal"><li><a class="tocitem" href="#Benchmark-1"><span>Benchmark</span></a></li></ul></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>SnoopCompile Bot (EXPERIMENTAL)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SnoopCompile Bot (EXPERIMENTAL)</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/timholy/SnoopCompile.jl/blob/master/docs/src/bot.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="SnoopCompile-Bot-(EXPERIMENTAL)-1"><a class="docs-heading-anchor" href="#SnoopCompile-Bot-(EXPERIMENTAL)-1">SnoopCompile Bot (EXPERIMENTAL)</a><a class="docs-heading-anchor-permalink" href="#SnoopCompile-Bot-(EXPERIMENTAL)-1" title="Permalink"></a></h1><p>You can use SnoopCompile bot to automatically and continuously create precompile files.</p><p>One should add 3 things to a package to make the bot work:</p><hr/><ul><li>Workflow file:</li></ul><p>create a workflow file with this path in your repository <code>.github/workflows/SnoopCompile.yml</code> and use the following content:</p><pre><code class="language-yaml">name: SnoopCompile

on:
  - push


jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        julia-version: [&#39;1.4.0-rc1&#39;] # using 1.4 and higher is better
        julia-arch: [x64]
        os: [ubuntu-latest]
    steps:
      - uses: actions/checkout@v2
      - uses: julia-actions/setup-julia@latest
        with:
          version: ${{ matrix.julia-version }}
      - name: Install dependencies
        run: julia --project -e &#39;using Pkg; Pkg.instantiate();&#39;
      - name : Add SnoopCompile and current package
        run: julia -e &#39;using Pkg; Pkg.add(&quot;SnoopCompile&quot;); Pkg.develop(PackageSpec(; path=pwd()));&#39;
      - name: Install Test dependencies
        run: julia -e &#39;using SnoopCompile; SnoopCompile.addtestdep()&#39;
      - name: Generating precompile files
        run: julia --project=@. -e &#39;include(&quot;deps/SnoopCompile/snoopCompile.jl&quot;)&#39;
      - name: Running Benchmark
        run: julia --project=@. -e &#39;include(&quot;deps/SnoopCompile/snoopBenchmark.jl&quot;)&#39;

      # https://github.com/marketplace/actions/create-pull-request
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: Update precompile_*.jl file
          committer: YOUR NAME &lt;yourEmail@something.com&gt; # Change `committer` to your name and your email.
          title: &#39;[AUTO] Update precompile_*.jl file&#39;
          labels: SnoopCompile
          branch: create-pull-request/SnoopCompile
      - name: Check output environment variable
        run: echo &quot;Pull Request Number - ${{ env.PULL_REQUEST_NUMBER }}&quot;</code></pre><p><code>Install Test dependencies</code> step is only needed if you have test dependencies other than Test. Otherwise, you should comment it. In this case, if your examples or tests have dependencies, you should add a <code>Test.toml</code> to your test folder.</p><pre><code class="language-yaml">- name: Install Test dependencies
  run: julia -e &#39;using SnoopCompile; SnoopCompile.addtestdep()&#39;</code></pre><p>For example for MatLang package:</p><p><a href="https://github.com/juliamatlab/MatLang/blob/master/.github/workflows/SnoopCompile.yml">Link</a></p><hr/><ul><li>Precompile script</li></ul><p>Add a <code>snoopCompile.jl</code> file under <code>deps/SnoopCompile</code>. The content of the file should be a script that &quot;exercises&quot; the functionality you&#39;d like to precompile. One option is to use your package&#39;s <code>&quot;runtests.jl&quot;</code> file, or you can write a custom script for this purpose.</p><p>For example, some examples that call the functions:</p><pre><code class="language-julia">using SnoopCompile

@snoopi_bot &quot;MatLang&quot; begin
  using MatLang
  examplePath = joinpath(dirname(dirname(pathof(MatLang))), &quot;examples&quot;)
  include(joinpath(examplePath,&quot;Language_Fundamentals&quot;, &quot;usage_Entering_Commands.jl&quot;))
  include(joinpath(examplePath,&quot;Language_Fundamentals&quot;, &quot;usage_Matrices_and_Arrays.jl&quot;))
  include(joinpath(examplePath,&quot;Language_Fundamentals&quot;, &quot;Data_Types&quot;, &quot;usage_Numeric_Types.jl&quot;))
end</code></pre><p><a href=" https:/github.com/juliamatlab/MatLang/blob/master/deps/SnoopCompile/snoopCompile.jl">Ref</a></p><p>or if you do not have additional examples, you can use your runtests.jl file using this syntax:</p><pre><code class="language-julia">using SnoopCompile

# using runtests:
@snoopi_bot &quot;MatLang&quot;</code></pre><p><a href="https://timholy.github.io/SnoopCompile.jl/stable/snoopi/#Precompile-scripts-1">Also look at this</a></p><hr/><ul><li>Include precompile signatures</li></ul><p>Two lines of (commented) code that includes the precompile file in your main module.</p><p>It is better to have these lines commented to continuously develop and change your package offline. snoopi_bot will find these lines of code and will uncomment them in the created pull request. If they are not commented the bot will leave it as is in the pull request:</p><pre><code class="language-julia"># include(&quot;../deps/SnoopCompile/precompile/precompile_MatLang.jl&quot;)
# _precompile_()</code></pre><p><a href="https://github.com/juliamatlab/MatLang/blob/072ff8ed9877cbb34f8583ae2cf928a5df18aa0c/src/MatLang.jl#L26">Ref</a></p><hr/><h2 id="Benchmark-1"><a class="docs-heading-anchor" href="#Benchmark-1">Benchmark</a><a class="docs-heading-anchor-permalink" href="#Benchmark-1" title="Permalink"></a></h2><p>To measure the effect of adding precompile files. Add a <code>snoopBenchmark.jl</code>. The content of this file can be the following:</p><p>Benchmarking the load infer time</p><pre><code class="language-julia">println(&quot;loading infer benchmark&quot;)

@snoopi_bench &quot;MatLang&quot; using MatLang</code></pre><p>Benchmarking the example infer time</p><pre><code class="language-julia">println(&quot;examples infer benchmark&quot;)

@snoopi_bench &quot;MatLang&quot; begin
    using MatLang
    examplePath = joinpath(dirname(dirname(pathof(MatLang))), &quot;examples&quot;)
    # include(joinpath(examplePath,&quot;Language_Fundamentals&quot;, &quot;usage_Entering_Commands.jl&quot;))
    include(joinpath(examplePath,&quot;Language_Fundamentals&quot;, &quot;usage_Matrices_and_Arrays.jl&quot;))
    include(joinpath(examplePath,&quot;Language_Fundamentals&quot;, &quot;Data_Types&quot;, &quot;usage_Numeric_Types.jl&quot;))
end</code></pre><p>Benchmarking the tests:</p><pre><code class="language-julia">@snoopi_bench &quot;MatLang&quot;</code></pre><p><a href="https://github.com/juliamatlab/MatLang/blob/master/deps/SnoopCompile/snoopBenchmark.jl">Ref</a></p><p>To run the benchmark online, add the following to your yaml file after <code>Generating precompile files</code> step:</p><pre><code class="language-yaml">- name: Running Benchmark
  run: julia --project=@. -e &#39;include(&quot;deps/SnoopCompile/snoopBenchmark.jl&quot;)&#39;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../userimg/">« Creating <code>userimg.jl</code> files</a><a class="docs-footer-nextpage" href="../reference/">Reference »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 25 February 2020 11:46">Tuesday 25 February 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
